<div class="row">
  <div class="container">
    <div class="row" id="alerta-roja">
      <div class="alerta-roja" id="msj"></div>
    </div>
    <a href="/products"><span class="glyphicon glyphicon-chevron-left"></span>Regresar al listado</a>
    <div class="row detalle-info">
      <div class="col-md-10 col-md-offset-1">
        <h2><%= @product.name %></h2>
        <div class="row detalles">
          <div class="col-md-5">
            <%= image_tag @product.image, class:"img-responsive img-detalle" %>
          </div>
          <div class="col-md-1"></div>
          <div class="col-md-6">
            <div class="bloques precio-inicial border-inf">
               <span class="no-ofertas"><span class="glyphicon glyphicon-hand-up"></span> Este Apple Watch tiene: <strong><%= @product.auctions.count %></strong> Ofertas hasta ahora</span>
               <br>
               <span class="tus-ofertas">- <%= auctionExists(cookies[:user], @product.id) %></span>
               <div class="precios-iniciales">
                <div class="precio" id="precioCC">
                  <b>Precio Inicial CON Correa</b><br>
                  <span id="priceCC">$<%= @product.price.to_i %></span>
                </div>
                <div class="precio" id="precioSC">
                  <b>Precio Inicial SIN Correa</b><br>
                  <span id="priceSC">$<%= @product.price_correa.to_i %></span>
                </div>
               </div>
            </div>

            <div class="bloques border-inf">
              <p><b>Modelos:</b></p>
              <input type="radio" name="correa" class="radiova" value="si" checked="checked"> <b>CON Correa</b>
              <input type="radio" name="correa" class="radiova radio-sin" value="no"> <b>SIN Correa</b>
            </div>

            <div class="bloques">
              <p>
                <b>Cantidad a ofrecer</b>
                <br>
                Ingresa la cantidad que deseas ofrecer por este Apple Watch:
              </p>
              <input type="number" class="oferta campo-login" id="pricea" placeholder="Monto a ofertar" value="<%= @product.price.to_i %>">
              <input style="vertical-align:baseline;min-width:120px;" type="button" class="btn btn-primary btn-login" id="ofertar" value="Ofertar"> 
            </div>

            <!--div class="price"><%= @product.price.to_i %></div>
            <input type="hidden" id="val1" value="<%= @product.price.to_i %>">
            <input type="hidden" id="val2" value="<%= @product.price_correa.to_i %>">
            <input type="number" value="<%= @product.price.to_i %>" id="pricea" placeholder="Monto a ofertar"-->
            <input type="hidden" id="idProducto" value="<%= @product.id %>">
            <input type="hidden" id="val1" value="<%= @product.price.to_i %>">
            <input type="hidden" id="val2" value="<%= @product.price_correa.to_i %>">
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <%= @product.description.html_safe %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  
<script type="text/javascript">
  jQuery(document).ready(function($) {
    $('#alerta-roja').hide();
    var radio = $('.radiova').val();
    /*if(radio == 'si'){
      $('#precioCC').show();
      $('#precioSC').hide();
    }*/
    
    $('.radiova').click(function(event) {
      if ($(this).val() == "no"){
       /* $('#precioCC').hide();
        $('#precioSC').show();*/
        $('.price').text($('#val2').val());
        $('#pricea').val($('#val2').val());
      }
      if ($(this).val() == "si"){
         /*$('#precioCC').show();
         $('#precioSC').hide();*/
         $('.price').text($('#val1').val());
         $('#pricea').val($('#val1').val());
      }
    });

    $('#pricea').keydown(function (e) {
        // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110]) !== -1 ||
             // Allow: Ctrl+A, Command+A
            (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) || 
             // Allow: home, end, left, right, down, up
            (e.keyCode >= 35 && e.keyCode <= 40)) {
                 // let it happen, don't do anything
                 return;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            e.preventDefault();
        }
    });


    $('#ofertar').click(function(event) {
      oferta = $('.oferta').val();
      preciminCC = parseInt($('#priceCC').text().replace('$',''));
      preciminSC = parseInt($('#priceSC').text().replace('$',''));

      
      var preciomin = preciminCC;
      if(radio == 'no'){
        preciomin = preciminSC;
      }

      if(parseInt(oferta) < preciomin){
        $('#alerta-roja').show();
        $('#msj').text('La ofeta debe ser mayor al precio mÃ­nimo');
        setTimeout(
        function() 
        {
          $('#alerta-roja').hide();
        }, 4000);
      }else{
        $.ajax({
          url: '/saveAuction',
          dataType: 'json',
          data: {param1: oferta, param2: <%= @product.id %>},
          success: function(data){
            if(data!==null){
              window.location.replace("/products");
            }else{
              $('#alerta-roja').show();
              $('#msj').text('Lo sentimos hubo un error, vuelve a intentarlo');
              setTimeout(
              function() 
              {
                $('#alerta-roja').hide();
              }, 4000);
            }   
          }
        });
      }
    });
    
  });
</script>

